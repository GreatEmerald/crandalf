#!/bin/sh

[ `git rev-parse --abbrev-ref HEAD` != master ] && exit 0

# create branches from the current master if they do not exist
for i in `grep -G '^package:' PACKAGES | sed 's/^package:\s*//' | sed 's/\s*//'`;
do
  if git show-ref --verify --quiet refs/heads/$i; then
    git checkout $i
    git rebase master
    Rscript cran-check.R
    echo `git add -A && git commit -m"update branch ${i} $(date)"`
    git checkout master
  else
    git branch $i
  fi
done
